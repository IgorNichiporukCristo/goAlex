{"version":3,"sources":["../../../src/components/Toast/ToastController.tsx"],"names":["React","useRef","useState","useEffect","useCallback","styled","css","keyframes","Fade","Toast","StyledRoot","ToastStyledRoot","useToast","showAnimation","position","hideAnimation","fadeIn","fadeOut","StyledFade","isVisible","div","ToastController","role","text","contentLeft","timeout","fade","hideToast","setIsVisible","hideTimeout","toastKey","animationEndHandler","current","setTimeout","clearTimeout"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect, useCallback } from 'react';\nimport styled, { css, keyframes } from 'styled-components';\n\nimport { Fade } from '../Fade';\n\nimport { ToastInfo } from './Toast.types';\nimport { Toast, StyledRoot as ToastStyledRoot } from './Toast';\nimport { useToast } from './useToast';\n\nconst showAnimation = (position: string) => keyframes`\n    0% {\n        transform: translate(-50%, ${position === 'top' && '-'}5rem);\n        opacity: 0;\n    }\n\n    80% {\n        transform: translate(-50%, 0);\n        opacity: 0.7;\n    }\n\n    100% {\n        opacity: 1;\n    }\n`;\nconst hideAnimation = (position: string) => keyframes`\n    0% {\n        opacity: 1;\n    }\n\n    20% {\n        transform: translate(-50%, 0);\n        opacity: 0.7;\n    }\n\n    100% {\n        transform: translate(-50%, ${position === 'top' && '-'}5rem);\n        opacity: 0;\n    }\n`;\n\nconst fadeIn = keyframes`\n    from {\n        opacity: 0;\n    }\n\n    to {\n        opacity: 1;\n    }\n`;\nconst fadeOut = keyframes`\n    from {\n        opacity: 1;\n    }\n\n    to {\n        opacity: 0;\n    }\n`;\n\nconst StyledFade = styled(Fade)<{ isVisible: boolean }>`\n    ${({ isVisible }) => css`\n        animation: 300ms ${isVisible ? fadeIn : fadeOut};\n    `};\n`;\n\nconst StyledRoot = styled.div<{ position: string; isVisible: boolean }>`\n    position: fixed;\n    left: 50%;\n    z-index: 1000;\n    transform: translateX(-50%);\n\n    ${({ position, isVisible }) => css`\n        ${position}: 5rem;\n        animation: 300ms ${isVisible ? showAnimation(position) : hideAnimation(position)};\n    `};\n\n    display: flex;\n    width: 0;\n\n    ${ToastStyledRoot} {\n        transform: translateX(-50%);\n        max-width: calc(100vw - 5rem);\n        flex-shrink: 0;\n    }\n`;\n\n/**\n * Создаёт <div />, который внутри себя содержит тост.\n * Цикл: show => timeout => hide.\n */\nexport const ToastController: React.FC<ToastInfo> = ({ role, text, contentLeft, position, timeout, fade }) => {\n    const { hideToast } = useToast();\n    const [isVisible, setIsVisible] = useState(true);\n    const hideTimeout = useRef<number | null>(null);\n    const toastKey = `${text}${position}`;\n\n    const animationEndHandler = useCallback(() => {\n        if (!isVisible) {\n            hideToast();\n            setIsVisible(true); // Необходимо вернуть булево к следующему вызову тоста\n        }\n        if (isVisible) {\n            hideTimeout.current = setTimeout(() => {\n                setIsVisible(false);\n            }, timeout);\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [timeout, isVisible]);\n\n    useEffect(() => {\n        return () => {\n            if (hideTimeout.current !== null) {\n                clearTimeout(hideTimeout.current);\n            }\n        };\n    }, []);\n\n    if (!text || !position) {\n        return null;\n    }\n\n    return (\n        <>\n            {fade && <StyledFade isVisible={isVisible} placement={position} />}\n            <StyledRoot key={toastKey} position={position} isVisible={isVisible} onAnimationEnd={animationEndHandler}>\n                <Toast role={role} text={text} contentLeft={contentLeft} />\n            </StyledRoot>\n        </>\n    );\n};\n"],"file":"ToastController.js"}