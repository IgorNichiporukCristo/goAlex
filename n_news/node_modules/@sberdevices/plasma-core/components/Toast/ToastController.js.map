{"version":3,"sources":["../../src/components/Toast/ToastController.tsx"],"names":["showAnimation","position","keyframes","hideAnimation","fadeIn","fadeOut","StyledFade","Fade","isVisible","css","StyledRoot","styled","div","ToastStyledRoot","ToastController","role","text","contentLeft","timeout","fade","hideToast","setIsVisible","hideTimeout","toastKey","animationEndHandler","current","setTimeout","clearTimeout"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect, useCallback } from 'react';\nimport styled, { css, keyframes } from 'styled-components';\n\nimport { Fade } from '../Fade';\n\nimport { ToastInfo } from './Toast.types';\nimport { Toast, StyledRoot as ToastStyledRoot } from './Toast';\nimport { useToast } from './useToast';\n\nconst showAnimation = (position: string) => keyframes`\n    0% {\n        transform: translate(-50%, ${position === 'top' && '-'}5rem);\n        opacity: 0;\n    }\n\n    80% {\n        transform: translate(-50%, 0);\n        opacity: 0.7;\n    }\n\n    100% {\n        opacity: 1;\n    }\n`;\nconst hideAnimation = (position: string) => keyframes`\n    0% {\n        opacity: 1;\n    }\n\n    20% {\n        transform: translate(-50%, 0);\n        opacity: 0.7;\n    }\n\n    100% {\n        transform: translate(-50%, ${position === 'top' && '-'}5rem);\n        opacity: 0;\n    }\n`;\n\nconst fadeIn = keyframes`\n    from {\n        opacity: 0;\n    }\n\n    to {\n        opacity: 1;\n    }\n`;\nconst fadeOut = keyframes`\n    from {\n        opacity: 1;\n    }\n\n    to {\n        opacity: 0;\n    }\n`;\n\nconst StyledFade = styled(Fade)<{ isVisible: boolean }>`\n    ${({ isVisible }) => css`\n        animation: 300ms ${isVisible ? fadeIn : fadeOut};\n    `};\n`;\n\nconst StyledRoot = styled.div<{ position: string; isVisible: boolean }>`\n    position: fixed;\n    left: 50%;\n    z-index: 1000;\n    transform: translateX(-50%);\n\n    ${({ position, isVisible }) => css`\n        ${position}: 5rem;\n        animation: 300ms ${isVisible ? showAnimation(position) : hideAnimation(position)};\n    `};\n\n    display: flex;\n    width: 0;\n\n    ${ToastStyledRoot} {\n        transform: translateX(-50%);\n        max-width: calc(100vw - 5rem);\n        flex-shrink: 0;\n    }\n`;\n\n/**\n * Создаёт <div />, который внутри себя содержит тост.\n * Цикл: show => timeout => hide.\n */\nexport const ToastController: React.FC<ToastInfo> = ({ role, text, contentLeft, position, timeout, fade }) => {\n    const { hideToast } = useToast();\n    const [isVisible, setIsVisible] = useState(true);\n    const hideTimeout = useRef<number | null>(null);\n    const toastKey = `${text}${position}`;\n\n    const animationEndHandler = useCallback(() => {\n        if (!isVisible) {\n            hideToast();\n            setIsVisible(true); // Необходимо вернуть булево к следующему вызову тоста\n        }\n        if (isVisible) {\n            hideTimeout.current = setTimeout(() => {\n                setIsVisible(false);\n            }, timeout);\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [timeout, isVisible]);\n\n    useEffect(() => {\n        return () => {\n            if (hideTimeout.current !== null) {\n                clearTimeout(hideTimeout.current);\n            }\n        };\n    }, []);\n\n    if (!text || !position) {\n        return null;\n    }\n\n    return (\n        <>\n            {fade && <StyledFade isVisible={isVisible} placement={position} />}\n            <StyledRoot key={toastKey} position={position} isVisible={isVisible} onAnimationEnd={animationEndHandler}>\n                <Toast role={role} text={text} contentLeft={contentLeft} />\n            </StyledRoot>\n        </>\n    );\n};\n"],"file":"ToastController.js"}