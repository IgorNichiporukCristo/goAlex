{"version":3,"sources":["../../../src/components/Dropdown/withAssistiveDropdown.tsx"],"names":["React","useState","useRef","useCallback","useEffect","DropdownUncontrolled","useKeyboardNavigation","INITIAL_INDEX","withAssistiveDropdown","Component","Dropdown","id","items","placement","trigger","disabled","menuRole","menuItemRole","closeOnSelect","onToggleExternal","onToggle","onItemSelectExternal","onItemSelect","onIndexChangeExternal","onIndexChange","rest","isOpen","setIsOpen","index","setIndex","openingMethod","newIsOpen","event","current","type","item","i","onBlur","onKeyDown","undefined"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useCallback, useEffect } from 'react';\nimport type { FC, ComponentType, ForwardRefExoticComponent } from 'react';\n\nimport { DropdownUncontrolled, DropdownUncontrolledProps } from './DropdownUncontrolled';\nimport { useKeyboardNavigation, INITIAL_INDEX } from './keyboardNavigation';\n\nexport interface WithAssistiveDropdownProps\n    extends Pick<\n        DropdownUncontrolledProps,\n        'id' | 'items' | 'placement' | 'trigger' | 'disabled' | 'onToggle' | 'onItemSelect'\n    > {\n    /**\n     * WAI-ARIA role меню в выпадающем списке.\n     */\n    menuRole?: string;\n    /**\n     * WAI-ARIA role элемента меню в выпадающем списке.\n     */\n    menuItemRole?: string;\n    /**\n     * Закрыть выпадающий список после выбора.\n     */\n    closeOnSelect?: boolean;\n    /**\n     * Обработчик изменения активного индекса элемента,\n     * на который встали клавиатурной навигацией и который нужно подсветить.\n     */\n    onIndexChange?: (index: number) => void;\n}\n\n/**\n * Декорирует переданный компонент, выводя доступный дропдаун.\n */\nexport const withAssistiveDropdown = <P extends object>(\n    Component: ComponentType<P> | ForwardRefExoticComponent<P>,\n    Dropdown: ComponentType<DropdownUncontrolledProps> = DropdownUncontrolled,\n): FC<P & WithAssistiveDropdownProps> => ({\n    id,\n    items,\n    placement,\n    trigger,\n    disabled,\n    menuRole,\n    menuItemRole,\n    closeOnSelect = true,\n    onToggle: onToggleExternal,\n    onItemSelect: onItemSelectExternal,\n    onIndexChange: onIndexChangeExternal,\n    ...rest\n}) => {\n    const [isOpen, setIsOpen] = useState(false);\n    const [index, setIndex] = useState(INITIAL_INDEX);\n    const openingMethod = useRef<string | null>(null);\n\n    const onToggle = useCallback(\n        (newIsOpen, event) => {\n            if (newIsOpen) {\n                openingMethod.current = event.type;\n            }\n            setIsOpen(newIsOpen);\n            onToggleExternal?.(newIsOpen, event);\n        },\n        [onToggleExternal],\n    );\n\n    const onItemSelect = useCallback(\n        (item, event) => {\n            if (closeOnSelect) {\n                onToggle?.(false, event);\n            }\n            onItemSelectExternal?.(item, event);\n        },\n        [onToggle, onItemSelectExternal, closeOnSelect],\n    );\n\n    const onIndexChange = useCallback(\n        (i) => {\n            setIndex(i);\n            onIndexChangeExternal?.(i);\n        },\n        [onIndexChangeExternal],\n    );\n\n    const onBlur = useCallback(() => {\n        if (openingMethod.current === 'keydown') {\n            setIsOpen(false);\n            setIndex(INITIAL_INDEX);\n        }\n    }, []);\n\n    const { onKeyDown } = useKeyboardNavigation({\n        items,\n        isOpen,\n        index,\n        onToggle,\n        onItemSelect,\n        onIndexChange,\n    });\n\n    useEffect(() => {\n        if (!isOpen) {\n            onIndexChange?.(INITIAL_INDEX);\n        }\n    }, [isOpen, onIndexChange]);\n\n    return (\n        <Dropdown\n            id={id}\n            role={menuRole}\n            itemRole={menuItemRole}\n            aria-labelledby={id ? `${id}-disclosure` : undefined}\n            isOpen={isOpen}\n            items={items}\n            placement={placement}\n            trigger={trigger}\n            disabled={disabled}\n            hoverIndex={index}\n            onBlur={onBlur}\n            onKeyDown={onKeyDown}\n            onToggle={onToggle}\n            onItemSelect={onItemSelect}\n        >\n            <Component\n                {...(rest as P)}\n                id={id ? `${id}-disclosure` : undefined}\n                isOpen={isOpen}\n                disabled={disabled}\n                aria-activedescendant={id && index >= 0 ? `${id}-item-${index}` : undefined}\n                aria-controls={id}\n                aria-expanded={isOpen}\n                aria-haspopup={menuRole}\n            />\n        </Dropdown>\n    );\n};\n"],"file":"withAssistiveDropdown.js"}