{"version":3,"sources":["../../../src/components/Modal/Modal.tsx"],"names":["React","ReactDOM","styled","css","keyframes","overlay","useUniqId","ModalsContext","MODALS_PORTAL_ID","ModalView","ESCAPE_KEYCODE","wrapperHideAnimation","bodyShowAnimation","bodyHideAnimation","StyledWrapper","div","isHiding","StyledOverlay","transparent","StyledModal","Modal","id","isOpen","onClose","rest","uniqId","innerId","wrapperRef","useRef","portalRef","controller","useContext","useEffect","portal","document","getElementById","createElement","setAttribute","style","position","zIndex","body","appendChild","current","unregister","onKeyDown","event","keyCode","contains","children","length","window","addEventListener","removeEventListener","register","createPortal","items","indexOf"],"mappings":"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","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport styled, { css, keyframes } from 'styled-components';\nimport { overlay, useUniqId } from '@sberdevices/plasma-core';\n\nimport { ModalsContext, MODALS_PORTAL_ID } from './ModalsContext';\nimport { ModalView, ModalViewProps } from './ModalView';\n\nexport interface ModalProps extends ModalViewProps {\n    isOpen: boolean;\n}\ninterface HidingProps {\n    isHiding?: boolean;\n}\n\nconst ESCAPE_KEYCODE = 27;\n\nconst wrapperHideAnimation = keyframes`\n    from {\n        opacity: 1;\n    }\n\n    to {\n        opacity: 0;\n    }\n`;\nconst bodyShowAnimation = keyframes`\n    from {\n        opacity: 0;\n        transform: translateY(-100%);\n    }\n\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n`;\nconst bodyHideAnimation = keyframes`\n    from {\n        opacity: 1;\n        transform: translateY(0);\n    }\n\n    to {\n        opacity: 0;\n        transform: translateY(-100%);\n    }\n`;\n\nconst StyledWrapper = styled.div<HidingProps>`\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 1;\n\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    ${({ isHiding }) =>\n        isHiding &&\n        css`\n            animation: 0.1s ${wrapperHideAnimation} ease-out;\n        `}\n`;\nconst StyledOverlay = styled.div<{ transparent?: boolean }>`\n    position: absolute;\n\n    width: 100%;\n    height: 100%;\n\n    background-color: ${({ transparent }) => (transparent ? 'transparent' : overlay)};\n\n    cursor: pointer;\n`;\nconst StyledModal = styled.div<HidingProps>`\n    position: absolute;\n\n    ${({ isHiding }) => css`\n        animation: 0.4s ${isHiding ? bodyHideAnimation : bodyShowAnimation} ease-out;\n    `}\n`;\n\n/**\n * Модальное окно.\n * Управляет показом/скрытием, подложкой и анимацией визуальной части модального окна.\n */\nexport const Modal: React.FC<ModalProps> = ({ id, isOpen, onClose, ...rest }) => {\n    const uniqId = useUniqId();\n    const innerId = id || uniqId;\n    const wrapperRef = React.useRef<HTMLDivElement | null>(null);\n    const portalRef = React.useRef<HTMLElement | null>(null);\n    const controller = React.useContext(ModalsContext);\n\n    React.useEffect(() => {\n        let portal = document.getElementById(MODALS_PORTAL_ID);\n\n        if (!portal) {\n            portal = document.createElement('div');\n            portal.setAttribute('id', MODALS_PORTAL_ID);\n            portal.setAttribute('aria-live', 'off');\n            portal.setAttribute('role', 'presentation');\n            portal.style.position = 'relative';\n            portal.style.zIndex = '9000';\n            document.body.appendChild(portal);\n        }\n\n        portalRef.current = portal;\n\n        return () => {\n            controller.unregister(innerId);\n        };\n    }, []);\n\n    React.useEffect(() => {\n        const onKeyDown = (event: KeyboardEvent) => {\n            if (\n                event.keyCode === ESCAPE_KEYCODE &&\n                wrapperRef.current &&\n                portalRef.current &&\n                portalRef.current.contains(wrapperRef.current) &&\n                portalRef.current.children[portalRef.current.children.length - 1] === wrapperRef.current\n            ) {\n                onClose?.();\n            }\n        };\n        window.addEventListener('keydown', onKeyDown);\n        return () => {\n            window.removeEventListener('keydown', onKeyDown);\n        };\n    }, []);\n\n    if (isOpen) {\n        controller.register(innerId);\n    } else {\n        controller.unregister(innerId);\n        return null;\n    }\n\n    return (\n        portalRef.current &&\n        ReactDOM.createPortal(\n            <StyledWrapper ref={wrapperRef}>\n                <StyledOverlay transparent={controller.items.indexOf(innerId) !== 0} onClick={onClose} />\n                <StyledModal>\n                    <ModalView onClose={onClose} {...rest} />\n                </StyledModal>\n            </StyledWrapper>,\n            portalRef.current,\n        )\n    );\n};\n"],"file":"Modal.js"}