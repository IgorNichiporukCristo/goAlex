{"version":3,"sources":["../../src/components/Modal/Modal.tsx"],"names":["ESCAPE_KEYCODE","wrapperHideAnimation","keyframes","bodyShowAnimation","bodyHideAnimation","StyledWrapper","styled","div","isHiding","css","StyledOverlay","transparent","overlay","StyledModal","Modal","id","isOpen","onClose","rest","uniqId","innerId","wrapperRef","React","useRef","portalRef","controller","useContext","ModalsContext","useEffect","portal","document","getElementById","MODALS_PORTAL_ID","createElement","setAttribute","style","position","zIndex","body","appendChild","current","unregister","onKeyDown","event","keyCode","contains","children","length","window","addEventListener","removeEventListener","register","ReactDOM","createPortal","items","indexOf"],"mappings":"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","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport styled, { css, keyframes } from 'styled-components';\nimport { overlay, useUniqId } from '@sberdevices/plasma-core';\n\nimport { ModalsContext, MODALS_PORTAL_ID } from './ModalsContext';\nimport { ModalView, ModalViewProps } from './ModalView';\n\nexport interface ModalProps extends ModalViewProps {\n    isOpen: boolean;\n}\ninterface HidingProps {\n    isHiding?: boolean;\n}\n\nconst ESCAPE_KEYCODE = 27;\n\nconst wrapperHideAnimation = keyframes`\n    from {\n        opacity: 1;\n    }\n\n    to {\n        opacity: 0;\n    }\n`;\nconst bodyShowAnimation = keyframes`\n    from {\n        opacity: 0;\n        transform: translateY(-100%);\n    }\n\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n`;\nconst bodyHideAnimation = keyframes`\n    from {\n        opacity: 1;\n        transform: translateY(0);\n    }\n\n    to {\n        opacity: 0;\n        transform: translateY(-100%);\n    }\n`;\n\nconst StyledWrapper = styled.div<HidingProps>`\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 1;\n\n    display: flex;\n    align-items: center;\n    justify-content: center;\n\n    ${({ isHiding }) =>\n        isHiding &&\n        css`\n            animation: 0.1s ${wrapperHideAnimation} ease-out;\n        `}\n`;\nconst StyledOverlay = styled.div<{ transparent?: boolean }>`\n    position: absolute;\n\n    width: 100%;\n    height: 100%;\n\n    background-color: ${({ transparent }) => (transparent ? 'transparent' : overlay)};\n\n    cursor: pointer;\n`;\nconst StyledModal = styled.div<HidingProps>`\n    position: absolute;\n\n    ${({ isHiding }) => css`\n        animation: 0.4s ${isHiding ? bodyHideAnimation : bodyShowAnimation} ease-out;\n    `}\n`;\n\n/**\n * Модальное окно.\n * Управляет показом/скрытием, подложкой и анимацией визуальной части модального окна.\n */\nexport const Modal: React.FC<ModalProps> = ({ id, isOpen, onClose, ...rest }) => {\n    const uniqId = useUniqId();\n    const innerId = id || uniqId;\n    const wrapperRef = React.useRef<HTMLDivElement | null>(null);\n    const portalRef = React.useRef<HTMLElement | null>(null);\n    const controller = React.useContext(ModalsContext);\n\n    React.useEffect(() => {\n        let portal = document.getElementById(MODALS_PORTAL_ID);\n\n        if (!portal) {\n            portal = document.createElement('div');\n            portal.setAttribute('id', MODALS_PORTAL_ID);\n            portal.setAttribute('aria-live', 'off');\n            portal.setAttribute('role', 'presentation');\n            portal.style.position = 'relative';\n            portal.style.zIndex = '9000';\n            document.body.appendChild(portal);\n        }\n\n        portalRef.current = portal;\n\n        return () => {\n            controller.unregister(innerId);\n        };\n    }, []);\n\n    React.useEffect(() => {\n        const onKeyDown = (event: KeyboardEvent) => {\n            if (\n                event.keyCode === ESCAPE_KEYCODE &&\n                wrapperRef.current &&\n                portalRef.current &&\n                portalRef.current.contains(wrapperRef.current) &&\n                portalRef.current.children[portalRef.current.children.length - 1] === wrapperRef.current\n            ) {\n                onClose?.();\n            }\n        };\n        window.addEventListener('keydown', onKeyDown);\n        return () => {\n            window.removeEventListener('keydown', onKeyDown);\n        };\n    }, []);\n\n    if (isOpen) {\n        controller.register(innerId);\n    } else {\n        controller.unregister(innerId);\n        return null;\n    }\n\n    return (\n        portalRef.current &&\n        ReactDOM.createPortal(\n            <StyledWrapper ref={wrapperRef}>\n                <StyledOverlay transparent={controller.items.indexOf(innerId) !== 0} onClick={onClose} />\n                <StyledModal>\n                    <ModalView onClose={onClose} {...rest} />\n                </StyledModal>\n            </StyledWrapper>,\n            portalRef.current,\n        )\n    );\n};\n"],"file":"Modal.js"}